# Интеграция Frontend с Backend

## Выполненные шаги

### 1. Настройка переменных окружения

Создан файл `.env` в директории `frontend/`:

```env
VITE_API_BASE_URL=http://localhost:3000
```

### 2. Конфигурация Tanstack React Query

В файле `frontend/src/app/providers/index.tsx` добавлен `QueryClientProvider`:

- Настроены опции по умолчанию:
  - `refetchOnWindowFocus: false` - не обновлять данные при фокусе на окне
  - `retry: 1` - одна попытка повтора при ошибке
  - `staleTime: 5 * 60 * 1000` - данные остаются свежими 5 минут

### 3. API клиент для работы с аватарами

Созданы файлы:

#### `frontend/src/shared/api/avatar.ts`

Содержит:

- Типы данных `Avatar`, `ListAvatarsResponse`, `ListAvatarsParams`
- Объект `avatarApi` с методами:
  - `list(params)` - получение списка аватаров с пагинацией
  - `getImageUrl(id, filter, size)` - формирование URL для изображения
  - `delete(id)` - удаление аватара

#### `frontend/src/shared/api/hooks/use-avatars.ts`

React Query хук для получения списка аватаров.

### 4. Обновление главной страницы

В `frontend/src/pages/home/ui/HomePage.tsx`:

- Добавлено отображение галереи аватаров
- Реализована обработка состояний загрузки и ошибок
- Создана адаптивная сетка для отображения изображений
- Добавлена обработка ошибок загрузки изображений

## Доступные API endpoints

Backend предоставляет следующие эндпоинты:

### GET /api/list

Получение списка аватаров с пагинацией

- Query параметры:
  - `pick` (необязательно): количество записей (по умолчанию 10, макс 100)
  - `offset` (необязательно): смещение (по умолчанию 0)

### GET /api/:id

Получение изображения аватара по ID

- Query параметры:
  - `filter` (необязательно): фильтр (grayscale, sepia, negative)
  - `size` (необязательно): размер (5-9, где 2^n)

### GET /api/health

Проверка состояния backend

### POST /api/generate

Генерация нового аватара

### DELETE /api/:id

Удаление аватара по ID

## Как запустить

### 1. Убедитесь, что backend запущен:

```bash
cd backend
npm run dev
```

Backend должен быть доступен на `http://localhost:3000`

### 2. Запустите frontend:

```bash
cd frontend
pnpm dev
```

Frontend будет доступен на `http://localhost:12965`

## Проверка работы

1. Откройте браузер и перейдите на главную страницу
2. Вы должны увидеть галерею аватаров из backend
3. Если аватары еще не созданы, отображается сообщение "Аватары не найдены"

## Особенности реализации

### Обработка ошибок

- При ошибке загрузки данных отображается сообщение об ошибке
- При ошибке загрузки изображения показывается placeholder

### Адаптивность

- На мобильных устройствах: 2 колонки
- На планшетах: 3 колонки
- На десктопах: 4 колонки

### Кеширование

- React Query автоматически кеширует данные на 5 минут
- При необходимости обновления можно использовать кнопку "Обновить"

## Структура файлов

```
frontend/src/
├── app/
│   └── providers/
│       └── index.tsx           # QueryClientProvider
├── shared/
│   └── api/
│       ├── index.ts            # Базовый API клиент
│       ├── avatar.ts           # API для работы с аватарами
│       └── hooks/
│           └── use-avatars.ts  # React Query хук
└── pages/
    └── home/
        └── ui/
            └── HomePage.tsx    # Главная страница с галереей
```

## Возможные улучшения

1. Добавить форму для генерации новых аватаров
2. Реализовать удаление аватаров из UI
3. Добавить фильтры изображений (grayscale, sepia, negative)
4. Реализовать бесконечную прокрутку или постраничную навигацию
5. Добавить возможность скачивания изображений
