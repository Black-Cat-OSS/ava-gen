# üìã GitHub Actions Workflows Guide

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-10-04  
**–í–µ—Ä—Å–∏—è:** 1.0

## üéØ –û–±–∑–æ—Ä

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **2 –æ—Å–Ω–æ–≤–Ω—ã—Ö workflow**:

1. **`ci.yml`** - Continuous Integration (—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å–±–æ—Ä–∫–∞)
2. **`deploy-prod.yml`** - Production Deployment (–¥–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä)

---

## üîÑ Workflow 1: CI (Continuous Integration)

### üìç –ü—É—Ç—å: `.github/workflows/ci.yml`

### üöÄ –¢—Ä–∏–≥–≥–µ—Ä—ã

1. **Pull Request –≤ develop (–±—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã):**
   - –ò–∑ –≤–µ—Ç–æ–∫ `feature/**`, `fix/**`
   - –¢–µ—Å—Ç—ã: SQLite + Local/S3 (~5-7 –º–∏–Ω—É—Ç)

2. **Push –≤ develop:**
   - –ü–æ—Å–ª–µ –º–µ—Ä–¥–∂–∞ PR
   - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ develop –≤–µ—Ç–∫–∏

3. **Pull Request –≤ main (–ø–æ–ª–Ω—ã–µ —Ç–µ—Å—Ç—ã):**
   - –ò–∑ –≤–µ—Ç–∫–∏ `develop`
   - –¢–µ—Å—Ç—ã: SQLite + PostgreSQL √ó Local/S3 (~15-20 –º–∏–Ω—É—Ç)
   - –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ production

4. **–†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫:**
   - Actions ‚Üí CI ‚Üí Run workflow
   - –ü–∞—Ä–∞–º–µ—Ç—Ä: `run_full_matrix` - –ø–æ–ª–Ω–æ–µ –º–∞—Ç—Ä–∏—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### üìä Stages

```mermaid
graph LR
    A[Lint Backend] --> C[Test Backend]
    B[Lint Frontend] --> D[Build Frontend]
    C --> E[Docker Build Test]
    D --> E
```

#### 1. **Lint Backend**

- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ backend –Ω–∞ –æ—à–∏–±–∫–∏ –ª–∏–Ω—Ç–µ—Ä–∞
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Prisma Client
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ pnpm –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

#### 2. **Lint Frontend**

- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ frontend –Ω–∞ –æ—à–∏–±–∫–∏ –ª–∏–Ω—Ç–µ—Ä–∞
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ pnpm –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

#### 3. **Test Backend (Matrix)**

**–ë—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã (PR –≤ develop, push –≤ develop):**

- ‚úÖ SQLite + Local Storage (~2 –º–∏–Ω)
- ‚úÖ SQLite + S3 Storage (~3 –º–∏–Ω)

**–ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (PR –≤ main):**

- ‚úÖ SQLite + Local Storage (~2 –º–∏–Ω)
- ‚úÖ SQLite + S3 Storage (~3 –º–∏–Ω)
- ‚úÖ PostgreSQL + Local Storage (~5 –º–∏–Ω)
- ‚úÖ PostgreSQL + S3 Storage (~6 –º–∏–Ω)

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**

- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è `settings.test.matrix.yaml`
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ GitHub Secrets –¥–ª—è S3 (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ PostgreSQL –¥–ª—è PostgreSQL —Ç–µ—Å—Ç–æ–≤
- –ó–∞–ø—É—Å–∫ unit –∏ e2e —Ç–µ—Å—Ç–æ–≤
- –ó–∞–≥—Ä—É–∑–∫–∞ coverage –≤ Codecov

#### 4. **Build Frontend**

- –°–±–æ—Ä–∫–∞ production –≤–µ—Ä—Å–∏–∏
- –ó–∞–≥—Ä—É–∑–∫–∞ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤

#### 5. **Docker Build Test**

- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–±–æ—Ä–∫–∏ Docker –æ–±—Ä–∞–∑–æ–≤:
  - Backend
  - Frontend
  - Gateway
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ GitHub Actions cache

### ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **–ë—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã:** ~5-7 –º–∏–Ω—É—Ç
- **–ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** ~15-20 –º–∏–Ω—É—Ç
- **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ:** pnpm store, Docker layers

---

## üö¢ Workflow 2: Deploy to Production

### üìç –ü—É—Ç—å: `.github/workflows/deploy-prod.yml`

### üöÄ –¢—Ä–∏–≥–≥–µ—Ä—ã

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫:**
   - Push –≤ `main` –≤–µ—Ç–∫—É (–ø–æ—Å–ª–µ –º–µ—Ä–¥–∂–∞ PR –∏–∑ develop)
   - –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ CI

2. **–†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ (–¥–ª—è —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤):**
   - Actions ‚Üí Deploy to Production ‚Üí Run workflow
   - –ü–∞—Ä–∞–º–µ—Ç—Ä: `skip_tests` - –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã (—Ç–æ–ª—å–∫–æ –¥–ª—è hotfix!)

### üìä Stages

```mermaid
graph LR
    A[Test Backend] --> C[Build Images]
    B[Test Frontend] --> C
    C --> D[Deploy]
    D --> E[Verify]
```

#### 1. **Test Backend & Frontend**

- –ë—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã (SQLite + Local/S3)
- –õ–∏–Ω—Ç–µ—Ä –¥–ª—è frontend
- –°–±–æ—Ä–∫–∞ frontend

#### 2. **Build Docker Images**

- –°–±–æ—Ä–∫–∞ –≤—Å–µ—Ö Docker –æ–±—Ä–∞–∑–æ–≤
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ GitHub Actions cache

#### 3. **Deploy to Production Server**

- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É –ø–æ SSH
- Pull –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –æ–±—Ä–∞–∑–æ–≤

#### 4. **Verify Deployment**

- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- Health check backend API
- Rollback –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

### üîê –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ Secrets

```
SSH_HOST          - IP –∞–¥—Ä–µ—Å production —Å–µ—Ä–≤–µ—Ä–∞
SSH_PORT          - SSH –ø–æ—Ä—Ç (–æ–±—ã—á–Ω–æ 22)
SSH_PRIVATE_KEY   - –ü—Ä–∏–≤–∞—Ç–Ω—ã–π SSH –∫–ª—é—á
SSH_USERNAME      - –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è SSH
APP_PATH          - –ü—É—Ç—å –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
```

### üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- SSH –∫–ª—é—á —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤—Ä–µ–º–µ–Ω–Ω–æ –∏ —É–¥–∞–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `environment: production` –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∑–∞—â–∏—Ç—ã
- Automatic cleanup –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

---

## üìù –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –Ω–æ–≤–æ–π —Ñ–∏—á–∏

```bash
# 1. –°–æ–∑–¥–∞–π—Ç–µ –≤–µ—Ç–∫—É
git checkout -b feature/9

# 2. –í–Ω–µ—Å–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ –∑–∞–∫–æ–º–º–∏—Ç—å—Ç–µ
git add .
git commit -m "feat: add new feature"

# 3. Push –≤ GitHub
git push origin feature/9

# 4. CI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è
# - –ë—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã (SQLite + Local/S3)
# - ~5-7 –º–∏–Ω—É—Ç
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: Pull Request —Å –ø–æ–ª–Ω—ã–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º

```bash
# 1. –°–æ–∑–¥–∞–π—Ç–µ PR –≤ develop –∏–ª–∏ main

# 2. –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
# - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Actions ‚Üí CI
# - Run workflow
# - Branch: –≤–∞—à–∞ –≤–µ—Ç–∫–∞
# - run_full_matrix: true

# 3. –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
# - –í—Å–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –ë–î –∏ storage
# - ~15-20 –º–∏–Ω—É—Ç
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: Production Deploy

```bash
# 1. Merge PR –≤ main
git checkout main
git merge develop
git push origin main

# 2. Deploy –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è
# - –¢–µ—Å—Ç—ã ‚Üí –°–±–æ—Ä–∫–∞ ‚Üí –î–µ–ø–ª–æ–π ‚Üí –ü—Ä–æ–≤–µ—Ä–∫–∞
# - ~10-15 –º–∏–Ω—É—Ç

# 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –≤ Actions
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: Hotfix –≤ Production

```bash
# 1. –°–æ–∑–¥–∞–π—Ç–µ fix –≤–µ—Ç–∫—É –æ—Ç main
git checkout -b fix/critical-bug main

# 2. –ò—Å–ø—Ä–∞–≤—å—Ç–µ –±–∞–≥ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ª–æ–∫–∞–ª—å–Ω–æ
pnpm run test

# 3. Push –∏ —Å–æ–∑–¥–∞–π—Ç–µ PR –≤ main
git push origin fix/critical-bug

# 4. –ü–æ—Å–ª–µ approve merge –≤ main
# Deploy –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è
```

---

## üéõÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Secrets

### 1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Settings —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```
Repository ‚Üí Settings ‚Üí Secrets and variables ‚Üí Actions
```

### 2. –î–æ–±–∞–≤—å—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Å–µ–∫—Ä–µ—Ç—ã

**–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):**

```
TEST_S3_ENDPOINT
TEST_S3_BUCKET
TEST_S3_ACCESS_KEY
TEST_S3_SECRET_KEY
TEST_S3_REGION
```

**–î–ª—è –¥–µ–ø–ª–æ—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):**

```
SSH_HOST
SSH_PORT
SSH_PRIVATE_KEY
SSH_USERNAME
APP_PATH
```

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

–ó–∞–ø—É—Å—Ç–∏—Ç–µ workflow –≤—Ä—É—á–Ω—É—é –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏.

---

## üêõ Troubleshooting

### CI –ø–∞–¥–∞–µ—Ç –Ω–∞ —Ç–µ—Å—Ç–∞—Ö

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
   - Actions ‚Üí CI ‚Üí Failed job ‚Üí View logs

2. **–õ–æ–∫–∞–ª—å–Ω–æ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ:**

   ```bash
   NODE_ENV=test pnpm run test
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:**
   - `backend/settings.test.yaml`
   - –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### Deploy –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ—Ç–∫—É:**
   - Deploy —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∏–∑ `main`

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã:**
   - –í—Å–µ –ª–∏ SSH —Å–µ–∫—Ä–µ—Ç—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã?

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞:**
   - –£ –≤–∞—Å –µ—Å—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ deploy?

### Docker Build –ø–∞–¥–∞–µ—Ç

1. **–û—á–∏—Å—Ç–∏—Ç–µ –∫–µ—à:**
   - –í—Ä—É—á–Ω—É—é –∑–∞–ø—É—Å—Ç–∏—Ç–µ workflow
   - GitHub Actions cache –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–≤—Ä–µ–∂–¥–µ–Ω

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ Dockerfile:**
   - –õ–æ–∫–∞–ª—å–Ω–∞—è —Å–±–æ—Ä–∫–∞: `docker build -f backend/docker/Dockerfile .`

### SSH Connection Failed

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ SSH –∫–ª—é—á:**
   - –§–æ—Ä–º–∞—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º (–≤–∫–ª—é—á–∞—è BEGIN/END —Å—Ç—Ä–æ–∫–∏)

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞:**

   ```bash
   ssh -p PORT USERNAME@HOST
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ firewall:**
   - GitHub Actions IP ranges –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω—ã

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### GitHub Actions Dashboard

```
Repository ‚Üí Actions
```

**–ü–æ–ª–µ–∑–Ω—ã–µ —Ñ–∏–ª—å—Ä—ã:**

- `event:push` - —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—É—Å–∫–∏
- `event:pull_request` - —Ç–æ–ª—å–∫–æ PR
- `event:workflow_dispatch` - —Ç–æ–ª—å–∫–æ —Ä—É—á–Ω—ã–µ –∑–∞–ø—É—Å–∫–∏

### Codecov Integration

- Coverage –æ—Ç—á–µ—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è
- –î–æ—Å—Ç—É–ø–Ω—ã –≤ PR comments
- Dashboard: https://codecov.io/gh/YOUR-ORG/avatar-gen

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [GitHub Secrets Configuration](GITHUB_SECRETS_CONFIGURATION.md)
- [Quick Start Testing](../testing/QUICK_START_TESTING.md)
- [DevOps Integration Guide](DEVOPS_INTEGRATION_GUIDE.md)

---

**–ü–æ–¥–¥–µ—Ä–∂–∫–∞:** DevOps Team  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-10-04
