# Changelog

Все значимые изменения в этом проекте будут документированы в этом файле.

Формат основан на [Keep a Changelog](https://keepachangelog.com/en/1.0.0/), и
этот проект придерживается
[Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [Unreleased]

## [0.0.2] - 2025-10-03

### Added

- **50 unit и E2E тестов для backend** с высоким покрытием кода
  - HealthController: 100% coverage (7 тестов)
  - AvatarController: 97.61% coverage (17 тестов)
  - AvatarService: 90.9% coverage (22 теста)
  - E2E тесты для health endpoints (4 теста)
  - Jest setup для ES modules (uuid, sharp)
- **Новая структура документации** - 8 тематических разделов:
  - `docs/getting-started/` - Быстрый старт
  - `docs/development/` - Руководство разработчика
  - `docs/deployment/` - Развертывание
  - `docs/api/` - API документация
  - `docs/testing/` - Тестирование
  - `docs/architecture/` - Архитектура
  - `docs/contributing/` - Контрибуция
  - `docs/archive/` - Архив устаревших документов
- **README хабы** для каждой директории документации (8 хабов)
- **Docker retry логика** для установки Alpine пакетов (3 попытки)
- **Альтернативные зеркала Alpine Linux** (Yandex mirror для надежности)
- **Метаданные проекта** в package.json:
  - repository: https://github.com/letnull19A/avatar-gen
  - bugs: URL для issues
  - homepage: URL репозитория
- **Документация по тестированию**:
  - `backend/docs/TESTING.md` - Полное руководство
  - `backend/docs/TEST_RESULTS.md` - Результаты и статистика
- **Документация Docker**:
  - `docker/README.md` - Основная документация
  - `docker/DOCKER_BUILD_FIXES.md` - Решение проблем сборки
- **Документация скриптов**: `scripts/README.md`

### Changed

- **Реорганизация Docker структуры**:
  - Перемещены docker-compose файлы из корня → `docker/`
  - Dockerfile остались в `backend/docker/` и `frontend/docker/`
  - Обновлены все относительные пути в compose файлах
- **Обновлены все скрипты управления** для новой Docker структуры:
  - `scripts/build.sh` - поддержка профилей (sqlite/postgresql)
  - `scripts/build-fast.sh` - быстрая сборка с кэшем
  - `scripts/start.sh` - опции запуска и профили
  - `scripts/dev.sh` - dev режим с профилями
  - `scripts/stop.sh` - опции удаления volumes
- **Лицензия изменена** с Apache License 2.0 → MIT License
- **Автор обновлен** на letnull19a
- **Обновлена вся документация** с правильными путями:
  - `storage/database/database.sqlite` вместо `prisma/storage/database.sqlite`
  - Обновлены все ссылки на перемещенные документы
- **Jest конфигурация** для поддержки ES modules:
  - Обновлен формат ts-jest конфигурации (убрано deprecated globals)
  - Добавлен setupFilesAfterEnv для моков
  - Настроено исключение из coverage (interfaces, enums, dto)
- **Docker Dockerfiles оптимизированы**:
  - Убран dumb-init из frontend (не нужен для Nginx)
  - Добавлен tsconfig.node.json в frontend build
  - Заменен wget → curl для healthcheck
  - Добавлена retry логика для apk add

### Fixed

- **Проблема с lint-staged**: добавлены eslint и prettier в корневой
  package.json
- **Дублирующиеся директории**:
  - Удалена `backend/backend/storage/` (создавалась при неправильном cwd)
  - Удалена `backend/prisma/storage/` (больше не используется)
- **Модуль инициализации** больше не создает `prisma/storage/` директорию
- **Устаревшие пути к БД** во всей документации исправлены
- **Проблемы сборки Docker образов**:
  - Решена проблема с dumb-init package
  - Решены временные ошибки Alpine репозиториев
  - Исправлена сборка frontend (отсутствовал tsconfig.node.json)
- **ES modules проблемы в тестах** (uuid, sharp) через jest-setup.ts
- **Пути в docker-compose** обновлены относительно новой структуры

### Removed

- **Удалены дублирующиеся docker-compose файлы** из корня проекта (перемещены в
  docker/)
- **Удалено дублирование Docker документации** (использование ссылок вместо
  копирования)
- **Архивированы устаревшие документы**:
  - `backend_task.md` → `docs/archive/` (первоначальное ТЗ, выполнено)
  - `MIGRATION_DOCKER_STRUCTURE.md` → `docs/archive/` (миграция завершена)
  - `REORGANIZATION_PLAN.md` → `docs/archive/`
  - `REORGANIZATION_SUMMARY.md` → `docs/archive/`
- **Удалено создание директории** `prisma/storage/` из модуля инициализации

### Documentation

- **Полная реорганизация** документации по тематическим разделам
- **Единая точка входа** - `docs/README.md` (единственный файл в корне docs/)
- **8 README хабов** для навигации по разделам
- **Обновлены все внутренние ссылки** после перемещения файлов
- **Централизованная навигация** с раскрывающимися секциями

## [0.0.1] - 2025-10-01

### Added

- Поддержка PostgreSQL в дополнение к SQLite
- Система повторных попыток подключения к базе данных (3 попытки с настраиваемой
  задержкой)
- Конфигурация базы данных только через YAML файл (settings.yaml)
- Автоматическая генерация .env файла из settings.yaml
- Полное исключение необходимости ручной настройки переменных окружения
- Docker Compose конфигурация с PostgreSQL
- Расширенная конфигурация базы данных с поддержкой обеих БД
- Документация по настройке баз данных (docs/database-setup.md)
- Поддержка Cursor IDE в конфигурации проекта
- Интеграция commitlint с husky для автоматической проверки сообщений коммитов
- Правила участия в проекте (CONTRIBUTING.md)
- Документация по сообщениям коммитов (docs/COMMIT_MESSAGES.md)
- Лицензия Apache License 2.0
- **Система конфигурации с поддержкой окружений**
  - Базовая конфигурация через `settings.yaml`
  - Окружение-специфичные настройки через `settings.{NODE_ENV}.yaml`
  - Автоматическое объединение конфигураций с переопределением настроек
  - Поддержка `development`, `production` и `test` окружений
  - Глубокое слияние объектов конфигурации

### Changed

- Обновлена Prisma схема для поддержки динамического выбора провайдера БД
- Улучшен DatabaseService с системой повторных попыток подключения
- Обновлена конфигурация ESLint и Prettier
- Улучшена структура проекта с использованием Feature-Sliced Design
- **Переработана система конфигурации приложения**
  - YamlConfigService теперь поддерживает окружение-специфичные настройки
  - Добавлено глубокое слияние конфигураций
  - Улучшена обработка ошибок при загрузке конфигурации
  - Обновлена документация по настройке конфигурации
  - Исправлена типизация в DirectoryInitializerService
- **Рефакторинг зависимостей модулей**
  - Убраны дублирующиеся инструменты разработки верхнего уровня (husky,
    commitlint) из модулей
  - Оставлены специфичные настройки eslint и prettier в каждом модуле
  - Объединены конфигурации инструментов разработки в корневой проект
  - Добавлены корневые скрипты для форматирования кода

### Fixed

- Исправлены конфликты слияния и ошибки линтинга
- **Исправлены дублирующиеся зависимости инструментов разработки**
  - Удалены дублирующиеся инструменты разработки верхнего уровня из модулей
  - Убраны дублирующиеся скрипты разработки из модулей
  - Настроена правильная интеграция инструментов разработки через корневой
    проект

### Added

- **Исправлено зависание backend при запуске**
  - Исправлено использование `console.debug` в SQLite сервисе базы данных
    (заменено на `this.logger.debug`)
  - Обновлена Prisma схема для использования прямого URL вместо переменной
    окружения `env("DATABASE_URL")`
  - Перегенерирован Prisma клиент с новой конфигурацией
  - Диагностировано и устранено зависание при создании NestJS приложения
  - Восстановлена полная функциональность приложения
  - Добавлена диагностика модулей для выявления проблем инициализации
  - Исправлены пути к конфигурационным файлам базы данных (относительные пути в
    settings.yaml)

- **Детальное логирование для диагностики проблем**
  - Перенесена настройка логирования из переменных окружения в YAML конфигурацию
  - Добавлены настройки логирования в `settings.yaml`:
    - `level`: уровень логирования (trace, debug, info, warn, error, fatal)
    - `verbose`: флаг включения детального логирования
    - `pretty`: флаг красивого вывода в консоль
  - Расширенное логирование в конфигурационном сервисе с выводом содержимого
    файлов
  - Детальное логирование процесса инициализации директорий
  - Подробное логирование этапов загрузки приложения
  - Автоматическое включение verbose режима в окружении разработки
    (`settings.development.yaml`)

- **Логирование статуса инициализации модулей**
  - Добавлен OnModuleInit интерфейс во все модули приложения
  - Каждый модуль выводит информативное сообщение при инициализации:
    - 🔧 ConfigModule: "Configuration service ready"
    - 🗄️ DatabaseModule: "Database service ready"
    - 🚀 InitializationModule: "Application initialization services ready"
    - 📝 LoggerModule: "Logging service ready"
    - 🎯 AppModule: "All application modules loaded successfully"
    - 🎨 AvatarModule: "Avatar generation services ready"
    - ⚡ GeneratorModule: "Avatar generation engine ready"
    - 💾 StorageModule: "File storage services ready"

- **Улучшенная обработка ошибок инициализации**
  - Добавлены try-catch блоки во все методы onModuleInit модулей
  - Детальное логирование ошибок инициализации с трассировкой стека
  - Специальная обработка ошибок в LoggerModule (использует console.error)
  - Улучшена обработка ошибок в DatabaseService с индикацией успешного
    подключения
  - Теперь при ошибке инициализации модуля сразу видно:
    - ❌ Какой модуль не смог инициализироваться
    - ❌ Детальное сообщение об ошибке
    - ❌ Трассировку стека для отладки

## [0.0.1] - 2025-09-26

### Added

- Базовая структура React SDK проекта с архитектурой Feature-Sliced Design
- Интеграция с Vite для быстрой сборки и разработки
- Поддержка TypeScript с строгой типизацией
- Настройка Tailwind CSS v4 для стилизации
- Интеграция Storybook для разработки и тестирования компонентов
- Система интернационализации (i18n) с поддержкой русского, английского и
  испанского языков
- Темная/светлая тема с автоматическим переключателем
- Мобильное меню с контекстом для адаптивной навигации
- Интеграция с React Query для управления серверным состоянием
- React Router для клиентской маршрутизации
- React Hook Form с Zod для валидации форм
- Поддержка SCSS модулей для стилизации компонентов
- Настройка ESLint с правилами для React и TypeScript
- Prettier для автоматического форматирования кода
- Husky для pre-commit хуков
- Commitlint для стандартизации сообщений коммитов
- Поддержка Cursor IDE в конфигурации проекта

### Pages

- HomePage - главная страница приложения
- AboutPage - страница о проекте
- LoginPage - страница авторизации
- DevStackPage - страница технологического стека

### Features

- CounterIncrement - компонент счетчика
- LanguageButton - кнопка переключения языка
- LanguageSwitcher - переключатель языка
- LoginForm - форма авторизации
- ThemeToggle - переключатель темы

### Widgets

- Header (Default, Minimalism, Search) - различные варианты шапки
- Footer - подвал сайта
- MobileMenu - мобильное меню

### UI Components

- Button - кнопка с различными вариантами стилей
- InputField - поле ввода с валидацией
- Callout - компонент для уведомлений
- NavigationLink - ссылка навигации
- OverlayBlur - размытый оверлей для модальных окон
- BurgerIcon - иконка гамбургер-меню
- FlagIcon - иконка флага страны
- LanguagePopup - всплывающее окно выбора языка

### Technical Stack

- React 19.1.1
- TypeScript 5.8.3
- Vite 7.1.7
- Tailwind CSS 4.1.13
- Storybook 9.1.8
- i18next 25.5.2
- React Query 5.90.2
- React Router 1.132.0
- React Hook Form 7.63.0
- Zod 4.1.11
- Sass 1.93.1

---

## Типы изменений

- **Added** - для новых функций
- **Changed** - для изменений в существующей функциональности
- **Deprecated** - для функций, которые скоро будут удалены
- **Removed** - для удаленных функций
- **Fixed** - для исправления ошибок
- **Security** - для исправлений уязвимостей
