# Initialization Module

–ú–æ–¥—É–ª—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∏–π –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É –æ–∫—Ä—É–∂–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ.

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ú–æ–¥—É–ª—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∏ —Ä–µ—Å—É—Ä—Å—ã —Å–æ–∑–¥–∞–Ω—ã –¥–æ –∑–∞–ø—É—Å–∫–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫–∏ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ú–æ–¥—É–ª—å –ø–æ—Å—Ç—Ä–æ–µ–Ω –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω—É **Manager** —Å –ø–ª–∞–≥–∏–Ω–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         InitializationModule (Global)           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                      ‚îÇ
           ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
           ‚îÇ InitializationService ‚îÇ ‚Üê –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä
           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                      ‚îÇ
     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
     ‚îÇ         IInitializer           ‚îÇ ‚Üê –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å
     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                      ‚îÇ
          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
          ‚îÇ DirectoryInitializer   ‚îÇ ‚Üê –ö–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
          ‚îÇ       Service         ‚îÇ
          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### 1. InitializationService

–û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä, —É–ø—Ä–∞–≤–ª—è—é—â–∏–π –≤—Å–µ–º–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ç–æ—Ä–∞–º–∏:

- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ç–æ—Ä–æ–≤
- –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤ –ø–æ—Ä—è–¥–∫–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –æ—Ç–∫–∞—Ç
- –°–±–æ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

#### 2. IInitializer (–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å)

–ö–æ–Ω—Ç—Ä–∞–∫—Ç –¥–ª—è –≤—Å–µ—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ç–æ—Ä–æ–≤:

- `getInitializerId()` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- `getPriority()` - –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- `initialize()` - –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- `rollback()` - –æ—Ç–∫–∞—Ç –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

#### 3. DirectoryInitializerService

–ö–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π:

- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
- –°–æ–∑–¥–∞–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å—Ç–∞—Ç—É—Å–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

–ú–æ–¥—É–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –±–ª–∞–≥–æ–¥–∞—Ä—è –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—É `@Global()` –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ `OnModuleInit`.

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

```typescript
// –í AppModule
@Module({
  imports: [
    ConfigModule,
    InitializationModule, // ‚Üê –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
    DatabaseModule,
    LoggerModule,
    AvatarModule,
  ],
})
export class AppModule {}
```

### –†—É—á–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```typescript
import { InitializationService } from './modules/initialization';

@Injectable()
export class MyService {
  constructor(private readonly initializationService: InitializationService) {}

  async someMethod() {
    // –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
    const status = this.initializationService.getAllInitializerStatus();

    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
    await this.initializationService.reinitialize();
  }
}
```

## üìÅ –°–æ–∑–¥–∞–≤–∞–µ–º—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏

–ú–æ–¥—É–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏–∑ `settings.yaml`:

### –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–ú–æ–¥—É–ª—å –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç `settings.yaml` –∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç –ø—É—Ç–∏ –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫:

- **`app.save_path`** - –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –∞–≤–∞—Ç–∞—Ä–æ–≤
- **`app.database.sqlite_params.url`** - –ø—É—Ç—å –∫ SQLite –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ `driver: 'sqlite'`)
- **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏** - `logs/`

‚ö†Ô∏è **–í–∞–∂–Ω–æ:** –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ –¥–ª—è SQLite**. –î–ª—è PostgreSQL —Å–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π

```
storage/                    # –û—Å–Ω–æ–≤–Ω–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ avatars/               # –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞–≤–∞—Ç–∞—Ä—ã (–∏–∑ app.save_path)
‚îî‚îÄ‚îÄ database/              # SQLite –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (–∏–∑ sqlite_params.url)
    ‚îî‚îÄ‚îÄ database.sqlite

logs/                      # –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```

### –ü—Ä–∏–º–µ—Ä –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫

**SQLite (–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è):**

```yaml
# settings.yaml
app:
  save_path: './storage/avatars' # ‚Üí —Å–æ–∑–¥–∞—Å—Ç storage/avatars/
  database:
    driver: 'sqlite'
    sqlite_params:
      url: 'file:./storage/database/database.sqlite' # ‚Üí —Å–æ–∑–¥–∞—Å—Ç storage/database/
```

**PostgreSQL (–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ë–î –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è):**

```yaml
# settings.yaml
app:
  save_path: './storage/avatars' # ‚Üí —Å–æ–∑–¥–∞—Å—Ç storage/avatars/
  database:
    driver: 'postgresql'
    network:
      host: 'localhost'
      port: 5432
      database: 'avatar_gen'
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π

–ú–æ–¥—É–ª—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

```typescript
// –í DirectoryInitializerService
private extractDirectoriesFromConfig(): string[] {
  const directories = new Set<string>();

  // –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∏–∑ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
  this.extractStorageDirectories(directories);
  this.extractDatabaseDirectories(directories);
  this.extractLogDirectories(directories);

  // –î–æ–±–∞–≤–ª—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
  this.addAdditionalDirectories(directories);

  return Array.from(directories).sort();
}
```

### –ú–µ—Ç–æ–¥—ã –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π

- **`extractStorageDirectories()`** - –∏–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∏–∑ `app.save_path`
- **`extractDatabaseDirectories()`** - –∏–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∏–∑ `app.database.sqlite_params.url` (—Ç–æ–ª—å–∫–æ –¥–ª—è SQLite)
- **`extractLogDirectories()`** - –¥–æ–±–∞–≤–ª—è–µ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `logs/`
- **`addAdditionalDirectories()`** - –¥–æ–±–∞–≤–ª—è–µ—Ç –∫–æ—Ä–Ω–µ–≤—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

## üîß API Reference

### InitializationService

#### –ú–µ—Ç–æ–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

##### `getInitializerStatus(initializerId: string): InitializationStatus | undefined`

–ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ç–æ—Ä–∞.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**

- `initializerId` - –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ç–æ—Ä–∞

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –°—Ç–∞—Ç—É—Å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–ª–∏ `undefined`

##### `getAllInitializerStatus(): InitializationStatus[]`

–ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –≤—Å–µ—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ç–æ—Ä–æ–≤.

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –ú–∞—Å—Å–∏–≤ —Å—Ç–∞—Ç—É—Å–æ–≤ –≤—Å–µ—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ç–æ—Ä–æ–≤

##### `reinitialize(): Promise<void>`

–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ç–æ—Ä–æ–≤.

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**

```typescript
await this.initializationService.reinitialize();
```

### DirectoryInitializerService

#### –ú–µ—Ç–æ–¥—ã —É—Ç–∏–ª–∏—Ç

##### `getDirectoryStatus(): Promise<DirectoryStatus>`

–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å—Ç–∞—Ç—É—Å–µ –≤—Å–µ—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π.

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**

```typescript
{
  storage: {
    'storage/avatars': {
      exists: true,
      size: 1024,
      created: '2025-10-01T12:00:00.000Z',
      modified: '2025-10-01T12:30:00.000Z'
    }
  }
}
```

##### `recreateDirectories(): Promise<void>`

–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ –≤—Å–µ—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π.

**–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ:** –£–¥–∞–ª—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏!

## üõ†Ô∏è –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –º–æ–¥—É–ª—è

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ç–æ—Ä–∞

1. **–°–æ–∑–¥–∞–π—Ç–µ —Å–µ—Ä–≤–∏—Å, —Ä–µ–∞–ª–∏–∑—É—é—â–∏–π IInitializer:**

```typescript
@Injectable()
export class DatabaseInitializerService implements IInitializer {
  getInitializerId(): string {
    return 'database-initializer';
  }

  getPriority(): number {
    return 50; // –ü–æ—Å–ª–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π, –Ω–æ –¥–æ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞
  }

  async isReady(): Promise<boolean> {
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π
    return true;
  }

  async initialize(): Promise<void> {
    // –õ–æ–≥–∏–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
    this.logger.log('Initializing database...');
  }

  async rollback(): Promise<void> {
    // –û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø—Ä–∏ –æ—à–∏–±–∫–µ
    this.logger.log('Rolling back database initialization...');
  }
}
```

2. **–î–æ–±–∞–≤—å—Ç–µ –≤ –º–æ–¥—É–ª—å:**

```typescript
@Module({
  providers: [
    InitializationService,
    DirectoryInitializerService,
    DatabaseInitializerService, // ‚Üê –ù–æ–≤—ã–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ç–æ—Ä
  ],
  exports: [InitializationService, DirectoryInitializerService, DatabaseInitializerService],
})
export class InitializationModule {}
```

3. **–û–±–Ω–æ–≤–∏—Ç–µ –∏–Ω–¥–µ–∫—Å:**

```typescript
// src/modules/initialization/index.ts
export { DatabaseInitializerService } from './services/database-initializer.service';
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –õ–æ–≥–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

```
[InitializationService] LOG Starting application initialization...
[InitializationService] LOG Discovered 2 initializers
[InitializationService] LOG Executing 2 initializers...
[InitializationService] LOG Initializing: directory-initializer (priority: 10)
[DirectoryInitializerService] LOG Initializing application directories...
[DirectoryInitializerService] LOG ‚úì Created directory: storage/avatars
[DirectoryInitializerService] LOG ‚úì Created directory: storage/database
[InitializationService] LOG ‚úì directory-initializer completed in 45ms
[InitializationService] LOG Initializing: database-initializer (priority: 50)
[DatabaseInitializerService] LOG Initializing database...
[InitializationService] LOG ‚úì database-initializer completed in 123ms
[InitializationService] LOG Application initialization completed successfully
```

### –°—Ç–∞—Ç—É—Å—ã –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

```typescript
const statuses = initializationService.getAllInitializerStatus();

statuses.forEach(status => {
  console.log(`${status.id}: ${status.status} (${status.duration}ms)`);
  if (status.error) {
    console.error(`Error: ${status.error}`);
  }
});
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–ú–æ–¥—É–ª—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —á–∏—Ç–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ `settings.yaml` –∏ —Å–æ–∑–¥–∞–µ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏.

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ settings.yaml

```yaml
app:
  save_path: './storage/avatars' # ‚Üê –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –∞–≤–∞—Ç–∞—Ä–æ–≤

database:
  sqlite_params:
    url: 'file:./storage/database/database.sqlite' # ‚Üê –ü—É—Ç—å –∫ –ë–î
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π

–ß—Ç–æ–±—ã –º–æ–¥—É–ª—å —Å–æ–∑–¥–∞–≤–∞–ª –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:

1. **–î–æ–±–∞–≤—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `settings.yaml`:**

   ```yaml
   app:
     temp_path: './storage/temp' # –ù–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
   ```

2. **–û–±–Ω–æ–≤–∏—Ç–µ —Å–µ—Ä–≤–∏—Å –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π:**

   ```typescript
   private extractStorageDirectories(directories: Set<string>): void {
     // –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –∞–≤–∞—Ç–∞—Ä–æ–≤
     if (this.config.app?.save_path) {
       const avatarDir = dirname(this.config.app.save_path);
       directories.add(avatarDir);
     }

     // –ù–æ–≤–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
     if (this.config.app?.temp_path) {
       const tempDir = dirname(this.config.app.temp_path);
       directories.add(tempDir);
     }
   }
   ```

3. **–û–±–Ω–æ–≤–∏—Ç–µ Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é** –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Unit —Ç–µ—Å—Ç—ã

```typescript
describe('DirectoryInitializerService', () => {
  let service: DirectoryInitializerService;

  beforeEach(async () => {
    const module = await Test.createTestingModule({
      providers: [DirectoryInitializerService],
    }).compile();

    service = module.get(DirectoryInitializerService);
  });

  it('should create required directories', async () => {
    await service.onModuleInit();

    const status = await service.getDirectoryStatus();
    expect(status.storage['storage/avatars'].exists).toBe(true);
    expect(status.storage['storage/database'].exists).toBe(true);
  });
});
```

### Integration —Ç–µ—Å—Ç—ã

```typescript
describe('InitializationModule', () => {
  let app: INestApplication;
  let initializationService: InitializationService;

  beforeAll(async () => {
    const module = await Test.createTestingModule({
      imports: [InitializationModule],
    }).compile();

    app = module.createNestApplication();
    await app.init();

    initializationService = module.get(InitializationService);
  });

  afterAll(async () => {
    await app.close();
  });

  it('should initialize all components', async () => {
    const statuses = initializationService.getAllInitializerStatus();

    expect(statuses).toHaveLength(1); // DirectoryInitializer
    expect(statuses[0].status).toBe('completed');
  });
});
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

–ú–æ–¥—É–ª—å –±–µ–∑–æ–ø–∞—Å–µ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:

- –°–æ–∑–¥–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
- –ù–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–π–ª—ã
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `recursive: true` —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- –õ–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –¥–ª—è –∞—É–¥–∏—Ç–∞

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **–°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è** - –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—É—Å–∫ –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π overhead** - —Å–æ–∑–¥–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º

## üîÑ –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –¥–ª—è –¥—Ä—É–≥–∏—Ö –Ω—É–∂–¥

–ú–æ–¥—É–ª—å –ª–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è–µ—Ç—Å—è –¥–ª—è –¥—Ä—É–≥–∏—Ö —Ç–∏–ø–æ–≤ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:

### –ü—Ä–∏–º–µ—Ä—ã –±—É–¥—É—â–∏—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ç–æ—Ä–æ–≤

#### DatabaseInitializerService

```typescript
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
async initialize(): Promise<void> {
  await this.databaseService.testConnection();
}
```

#### ConfigurationInitializerService

```typescript
// –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
async initialize(): Promise<void> {
  await this.configService.validateSettings();
}
```

#### CacheInitializerService

```typescript
// –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∫—ç—à–∞
async initialize(): Promise<void> {
  await this.cacheService.warmup();
}
```

#### MigrationInitializerService

```typescript
// –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –ë–î
async initialize(): Promise<void> {
  await this.migrationService.runPendingMigrations();
}
```

## üìö –°–≤—è–∑–∞–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [NestJS Modules](https://docs.nestjs.com/modules)
- [NestJS Lifecycle](https://docs.nestjs.com/fundamentals/lifecycle-events)
- [File System Operations](https://nodejs.org/api/fs.html)

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-10-01
**–í–µ—Ä—Å–∏—è:** 1.0.0
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
