#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ä–µ–¥—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
echo "üöÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ä–µ–¥—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –¥–ª—è Avatar Generator..."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ Node.js
if ! command -v node &> /dev/null; then
    echo "‚ùå Node.js –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Node.js 18+ –≤–µ—Ä—Å–∏–∏"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–µ—Ä—Å–∏—é Node.js
NODE_VERSION=$(node -v | cut -d'v' -f2 | cut -d'.' -f1)
if [ "$NODE_VERSION" -lt 18 ]; then
    echo "‚ùå –¢—Ä–µ–±—É–µ—Ç—Å—è Node.js –≤–µ—Ä—Å–∏–∏ 18 –∏–ª–∏ –≤—ã—à–µ. –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è: $(node -v)"
    exit 1
fi

echo "‚úÖ Node.js $(node -v) –Ω–∞–π–¥–µ–Ω"

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ –∫–æ—Ä–Ω–µ
echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞..."
npm install

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è –±—ç–∫–µ–Ω–¥–∞
echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –¥–ª—è –±—ç–∫–µ–Ω–¥–∞..."
cd backend && npm install && cd ..

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ (–µ—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
if [ -d "frontend" ]; then
    echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞..."
    cd frontend && npm install && cd ..
fi

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Husky
echo "üêï –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Husky..."
npm run prepare

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
if [ ! -d ".git" ]; then
    echo "‚ö†Ô∏è  Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º..."
    git init
fi

# –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º Git hooks
echo "üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Git hooks..."
chmod +x .husky/*

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Git
echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ Git..."
if [ -z "$(git config user.name)" ]; then
    echo "‚ö†Ô∏è  –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Git –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ"
    echo "–í—ã–ø–æ–ª–Ω–∏—Ç–µ: git config --global user.name '–í–∞—à–µ –ò–º—è'"
fi

if [ -z "$(git config user.email)" ]; then
    echo "‚ö†Ô∏è  Email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Git –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω"
    echo "–í—ã–ø–æ–ª–Ω–∏—Ç–µ: git config --global user.email 'your.email@example.com'"
fi

echo ""
echo "üéâ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
echo ""
echo "üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:"
echo "1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Git –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:"
echo "   git config --global user.name '–í–∞—à–µ –ò–º—è'"
echo "   git config --global user.email 'your.email@example.com'"
echo ""
echo "2. –°–¥–µ–ª–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π –∫–æ–º–º–∏—Ç:"
echo "   npm run commit"
echo ""
echo "3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç:"
echo "   npm run dev"
echo ""
echo "üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:"
echo "- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Ö—É–∫–∞–º: .husky/README.md"
echo "- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è commitlint: commitlint.config.js"
echo "- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è prettier: .prettierrc"
